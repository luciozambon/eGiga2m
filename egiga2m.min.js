var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(a){return a.raw=a};$jscomp.createTemplateTagFirstArgWithRaw=function(a,b){a.raw=b;return a};var version="1.18.7";console.log("eGiga2m, version",version);
var visited=[],activePoint=-1,mychart=-1,myPlot=-1,myRequest,myStart,myStop,exportURL="undefined",plotURL="undefined",jsonURL="undefined",exportFormat="csv",exportBlanks="",exportDecimation="",curves,myPlotClass=[],myHistory=[],myHistoryCounter=-1,plotService="./lib/service/plot_service.php?conf=",treeService="./lib/service/tree_service.php?conf=",updateService="",exportService="./lib/service/export_service.php?conf=",hcExportService="http://export.highcharts.com",zoom_speed=document.getElementById("zoomFactor")?
document.getElementById("zoomFactor").value:10,globalVal,globalLabel,minVal,maxVal,tsLabel,animationDelay,frameNum,updatePlot=0,decimation="maxmin",max_event_num=1E3,decimationSamples=1E3,updateBackground=300,updateRequest="",updateDecimation=0,updateCounter=0,updateId=!1,downtimeCheck=!1,visible=[],parameters={correlation:null},ftree=null,flotOptions={series:{lines:{show:!0}},grid:{hoverable:!0,clickable:!0},xaxis:{tickLength:5},yaxis:{position:"left"},legend:{position:"sw"},canvas:!0},csvImport=
{name:"",lines:[]},fade_level=[];for(j=0;j<events.length;j++)fade_level[events[j]]=1;var $_GET=getQueryParams(document.location.search);"undefined"!==typeof $_GET.conf?(document.getElementById("conf").value=$_GET.conf,initConf($_GET.conf)):initConf(!1);"undefined"!==typeof $_GET.debug&&console.log("init, $_GET",$_GET);localStorage.length&&"undefined"!==typeof localStorage.csvrepo&&(document.getElementById("csvrepo").value=localStorage.csvrepo,document.getElementById("retain").value=localStorage.csvrepo);
"undefined"!==typeof $_GET.max_event_num&&(max_event_num=$_GET.max_event_num,$("#max_event_num").val(max_event_num));"undefined"!==typeof $_GET.plotservice&&(plotService=$_GET.plotservice);for(var i in parameters)"undefined"!==typeof $_GET[i]&&(parameters[i]=$_GET[i],document.getElementById(i).checked=!0);"undefined"!==typeof $_GET.visible&&(visible=$_GET.visible.split(";"));"undefined"!==typeof $_GET.decimation&&(decimation=$_GET.decimation);
"undefined"!==typeof $_GET.hideOverMaxmin&&document.getElementById("hideOverMaxmin")&&(document.getElementById("hideOverMaxmin").checked=!0);"undefined"!==typeof $_GET.downtimeCheck&&(downtimeCheck=!0);document.getElementById("downtimeCheck")&&(document.getElementById("downtimeCheck").checked=downtimeCheck);document.getElementById("decimation_"+decimation)&&(document.getElementById("decimation_"+decimation).selected=!0);"undefined"!==typeof $_GET.decimation_samples&&(decimationSamples=$_GET.decimation_samples);
document.getElementById("decimationSamples")&&(document.getElementById("decimationSamples").value=decimationSamples);"boolean"!==typeof isHighChartsInstalled&&(document.getElementById("show_hc").checked=!1,document.getElementById("show_error").checked=!1,document.getElementById("hc_label").style.display="none",document.getElementById("style_output").style.display="none");
isHighChartsInstalled||(document.getElementById("show_chartjs")?document.getElementById("show_chartjs").checked=!0:document.getElementById("show_flot")&&(document.getElementById("show_flot").checked=!0));"undefined"===typeof formula_edit&&initPlot($_GET);"undefined"!==typeof window.$_GET.tsLabel&&(tsLabel=window.$_GET.tsLabel.split(";"));initTree($_GET);"string"===typeof see_also&&document.getElementById("see_also")&&(document.getElementById("see_also_button").style.display="inline");
function update_see_also(){var a={"\x3c!--start--\x3e":document.getElementById("startInput").value,"\x3c!--stop--\x3e":document.getElementById("stopInput").value,"\x3c!--decimation--\x3e":decimation};document.getElementById("see_also").innerHTML=strtr(see_also,a)}function popup(a,b,d){this.popupWindow=null;this.open=function(){this.popupWindow?this.popupWindow.closed?this.popupWindow=window.open(a,b,d):this.popupWindow.focus():this.popupWindow=window.open(a,b,d)}}
if("undefined"!==typeof $_GET.formula){var myPopup=new popup("./formula_editor.html?conf="+$_GET.conf,"formula","width=670,height=800");myPopup.open()}
function print_r(a){var b=new popup("","mywindow","width=600,height=400");b.open();if(a.constructor==Array||a.constructor==Object){b.popupWindow.document.write("<ul>");for(var d in a)a[d].constructor==Array||a[d].constructor==Object?(b.popupWindow.document.write("<li>["+d+"] => "+typeof a+"</li>"),b.popupWindow.document.write("<ul>"),print_r(a[d]),b.popupWindow.document.write("</ul>")):b.popupWindow.document.write("<li>["+d+"] => "+a[d]+"</li>");b.popupWindow.document.write("</ul>")}}
function openFormula(){(new popup("./formula_editor.html?conf="+document.getElementById("conf").value,"formula","width=670,height=800")).open()}function returnFormula(a){document.getElementById("ts").value=a+";"+document.getElementById("ts").value}var hidden,visibilityChange;
"undefined"!==typeof document.hidden?(hidden="hidden",visibilityChange="visibilitychange"):"undefined"!==typeof document.mozHidden?(hidden="mozHidden",visibilityChange="mozvisibilitychange"):"undefined"!==typeof document.msHidden?(hidden="msHidden",visibilityChange="msvisibilitychange"):"undefined"!==typeof document.webkitHidden&&(hidden="webkitHidden",visibilityChange="webkitvisibilitychange");var videoElement=document.getElementById("videoElement");
function handleVisibilityChange(){updateDecimation=document[hidden]?Math.ceil(updateBackground/updatePlot):updateDecimation=0}"undefined"===typeof document.addEventListener||"undefined"===typeof document[hidden]?alert("This feature requires a browser, such as Google Chrome or Firefox, that supports the Page Visibility API."):document.addEventListener(visibilityChange,handleVisibilityChange,!1);
function exportImage(a){if(document.getElementById("show_chartjs").checked){var b=document.getElementById("canvas").toDataURL("image/png");b=b.replace(/^data:image\/[^;]*/,"data:application/octet-stream");b=b.replace(/^data:application\/octet-stream/,"data:application/octet-stream;headers=Content-Disposition%3A%20attachment%3B%20filename=eGiga2m.png");document.getElementById("pngExport").href=b;document.getElementById("pngExport").download="eGiga2m."+a;console.log(b)}else if(document.getElementById("show_flot").checked)Canvas2Image.saveAsPNG(myPlot.getCanvas());
else{b=$("div.highcharts-legend")[0].style.left.replace("px","")-0;for(var d=$("div.highcharts-legend")[0].style.top.replace("px","")-0,f=$("div.highcharts-legend-item"),g="",e=0;e<f.length;e++){var h=f[e].style.left.replace("px","")-0,k=f[e].style.top.replace("px","")-0;g=g+'<text x="'+(b+h+25)+'" y="'+(d+k+15)+'">'+f[e].children[0].children[0].innerText+"</text>"}b=$(".highcharts-container")[0].innerHTML.split("</svg>")[0]+g+"</svg>";$.post("./lib/img/export.php",{svg:b,format:a},function(r){r=
document.createElement("a");var q=Date.now();r.href="./lib/img/export."+a+"?"+q;r.download="eGiga2m."+a;document.body.appendChild(r);r.click();document.body.removeChild(r)})}}
function updateLink(a){var b="";if(null==ftree&&document.getElementById("ts").value.length)b="&ts="+document.getElementById("ts").value;else{var d=[],f=$("#tree").fancytree("getTree");f&&f.visit(function(u){u.folder||("./img/y1axis.png"==u.data.icon&&d.push(u.key+",1,1"),"./img/y2axis.png"==u.data.icon&&d.push(u.key+",1,2"),"./img/xaxis.png"==u.data.icon&&d.push(u.key+",1,2"),"./img/surface.png"==u.data.icon&&d.push(u.key+",surface"),"./img/animation.png"==u.data.icon&&d.push(u.key+",animation"),
"./img/multi.png"==u.data.icon&&d.push(u.key+",multi"))});d.length&&(b="&ts="+d.join(";").split("csvrepo_").join(""))}var g="";document.getElementById("start").value.length?g="&start="+document.getElementById("start").value:document.getElementById("startInput").value.length&&(g="&start="+document.getElementById("startInput").value);var e="";document.getElementById("stop").value.length?e="&stop="+document.getElementById("stop").value:document.getElementById("startInput")&&document.getElementById("startInput").value.length&&
(e="&stop="+document.getElementById("stopInput").value);f=document.getElementById("conf").value.length?"conf="+document.getElementById("conf").value:"conf=";var h="",k=document.getElementById("minY").value;1<k.length&&(h="&minY="+k);k=document.getElementById("maxY").value;1<k.length&&(h+="&maxY="+k);k=document.getElementById("logY").value;""!=k&&"0;0"!=k&&(h+="&logY="+k);var r=document.getElementById("style").value;r.length&&(r="&style="+r);var q=document.getElementById("height").value;q.length&&
(q="&height="+q);k=document.getElementById("show_flot").checked?"&show_flot=true":"";var v=document.getElementById("show_chartjs").checked?"&show_chartjs=true":"",l=document.getElementById("show_table").checked?"&show_table=true":"",m="undefined"!==typeof location.pathname?location.pathname:"undefined"!==typeof window.location.pathname?window.location.pathname:"undefined"!==typeof document.location.pathname?document.location.pathname:"./egiga2m.html";path=m.split("/");var n="";for(j=0;j<events.length;j++)n+=
document.getElementById("show_"+events[j]).checked?"&show_"+events[j]+"="+document.getElementById("filter_"+events[j]).value:"";var t=window.location.protocol+"//"+window.location.host+path.join("/");path[path.length-1]=-1==m.indexOf(".html")?path[path.length-1]+"index_plot.html":path[path.length-1].replace(".html","_plot.html");plotURL=window.location.protocol+"//"+window.location.host+path.join("/");path.pop();0==exportService.indexOf("./")&&(exportService=window.location.protocol+"//"+window.location.host+
path.join("/")+exportService.substr(1));exportURL=exportService+g+e+b;var A=document.getElementById("downtimeCheck").checked?"&downtimeCheck=true":"",C="maxmin"!==decimation?"&decimation="+decimation:"",y=1E3!=decimationSamples?"&decimationSamples="+decimationSamples:"",p=1E3!=max_event_num?"&max_event_num="+max_event_num:"",x=document.getElementById("hideOverMaxmin")&&document.getElementById("hideOverMaxmin").checked?"&hideOverMaxmin=true":"";m=f+g+e+b;h=h+r+q+C+y+p+A+x;for(var z in parameters)document.getElementById(z)&&
document.getElementById(z).checked&&(h=h+"&"+z+"=true");jsonURL=window.location.protocol+"//"+window.location.host+path.join("/")+plotService.substr(1)+g+e+b+h;b=window.location.protocol+"//"+window.location.host+path.join("/")+treeService.substr(1)+g+e+b+h;if("undefined"!==typeof a){if("history"==a)return m+h+""+k+v+l;window.location=t+"?"+f+g+e+"&ts="+a+h+k+v+l}else a=(m+h+""+k+v+l+n).replace("&show_error=",""),-1<plotService.indexOf("analysis")&&(a=a+"&plotservice="+plotService.replaceAll("&",
"%26")),document.getElementById("plotOnly").setAttribute("onClick","javascript: location='"+plotURL+"?"+a+"'"),document.getElementById("plotOnly").innerHTML=plotURL+"?"+a,document.getElementById("plotAndControls").setAttribute("onClick","javascript: location='"+t+"?"+a+"'"),document.getElementById("plotAndControls").innerHTML=t+"?"+a,document.getElementById("scratch")&&(document.getElementById("scratch").setAttribute("onClick","javascript: location='"+t+"?"+f+"'"),document.getElementById("scratch").innerHTML=
t+"?"+f),exportBlanks=document.getElementById("exportZoh").checked?"&zoh":document.getElementById("exportFoh").checked?"&foh":"",exportFormat=document.getElementById("exportCsv").checked?"csv":"",exportFormat=document.getElementById("exportXls").checked?"xlsx":exportFormat,exportFormat=document.getElementById("exportMat").checked?"mat":exportFormat,exportFormat=document.getElementById("exportIgor").checked?"itx":exportFormat,exportFormat=document.getElementById("exportJson")&&document.getElementById("exportJson").checked?
"json":exportFormat,exportDecimation=evalExportDecimation(),refreshExportLink(),document.getElementById("exportCsv").setAttribute("onClick","javascript: exportFormat = 'csv';document.getElementById('matDisabled').style.display='inline'; refreshExportLink();"),document.getElementById("exportXls").setAttribute("onClick","javascript: exportFormat = 'xlsx';document.getElementById('matDisabled').style.display='inline'; refreshExportLink();"),document.getElementById("exportMat")&&document.getElementById("exportMat").setAttribute("onClick",
"javascript: exportFormat = 'mat';document.getElementById('matDisabled').style.display='none'; refreshExportLink();"),document.getElementById("exportIgor")&&document.getElementById("exportIgor").setAttribute("onClick","javascript: exportFormat = 'itx';document.getElementById('matDisabled').style.display='inline'; refreshExportLink();"),document.getElementById("exportJson")&&(document.getElementById("exportJson").setAttribute("onClick","javascript: exportFormat = 'json';document.getElementById('matDisabled').style.display='none'; refreshExportLink();"),
document.getElementById("exportJson").innerHTML=jsonURL),document.getElementById("exportTreeJson")&&(document.getElementById("exportTreeJson").setAttribute("onClick","javascript: location='"+b+"'"),document.getElementById("exportTreeJson").innerHTML=b),document.getElementById("exportBlanks").setAttribute("onClick","javascript: exportBlanks = '';refreshExportLink();"),document.getElementById("exportZoh").setAttribute("onClick","javascript: exportBlanks = '&zoh';refreshExportLink();"),document.getElementById("exportFoh").setAttribute("onClick",
"javascript: exportBlanks = '&foh';refreshExportLink();"),document.getElementById("exportSamplesNumber").setAttribute("onChange","javascript: exportDecimation = evalExportDecimation();refreshExportLink();"),document.getElementById("exportMaxmin").setAttribute("onClick","javascript: exportDecimation = evalExportDecimation();refreshExportLink();"),document.getElementById("exportMean").setAttribute("onClick","javascript: exportDecimation = evalExportDecimation();refreshExportLink();"),document.getElementById("exportAvg").setAttribute("onClick",
"javascript: exportDecimation = evalExportDecimation();refreshExportLink();"),document.getElementById("tsLabel").setAttribute("onChange","javascript: refreshExportLink();"),document.getElementById("nullValue").setAttribute("onChange","javascript: refreshExportLink();"),document.getElementById("timestamp").setAttribute("onChange","javascript: refreshExportLink();"),document.getElementById("multiParam").value=plotURL+"?"+m+h+k+n}
function getFormattedDate(a){a=new Date(a);var b=a.getMonth()+1,d=a.getDate(),f=a.getHours(),g=a.getMinutes(),e=a.getSeconds();b=(10>b?"0":"")+b;d=(10>d?"0":"")+d;f=(10>f?"0":"")+f;g=(10>g?"0":"")+g;e=(10>e?"0":"")+e;return a.getFullYear()+"-"+b+"-"+d+" "+f+":"+g+":"+e}
function previous_period(){var a=document.getElementById("startInput").value,b=document.getElementById("stopInput").value;if(19==a.length&&-1==a.indexOf("last")){var d=a.substring(0,10)+"T"+a.substring(11);if(19==b.length&&-1==b.indexOf("last")){var f=b.substring(0,10)+"T"+b.substring(11);f=(new Date(f)).getTime()-(new Date(d)).getTime();document.getElementById("stopInput").value=a;document.getElementById("startInput").value=getFormattedDate((new Date(d)).getTime()-f)}2>b.length&&(document.getElementById("stopInput").value=
a,document.getElementById("startInput").value=getFormattedDate((new Date(d)).getTime()-864E5))}-1!==a.indexOf("last")&&(a=a.split(" "),a[1]*=2,document.getElementById("startInput").value=a.join(" "))}
function following_period(){var a=document.getElementById("startInput").value,b=document.getElementById("stopInput").value;if(19==a.length&&-1==a.indexOf("last")){var d=a.substring(0,10)+"T"+a.substring(11);if(19==b.length&&-1==b.indexOf("last")){var f=b.substring(0,10)+"T"+b.substring(11),g=(new Date(f)).getTime()-(new Date(d)).getTime();document.getElementById("startInput").value=b;document.getElementById("stopInput").value=getFormattedDate((new Date(f)).getTime()+g)}2>b.length&&(document.getElementById("stopInput").value=
getFormattedDate((new Date(d)).getTime()+864E5))}-1!==a.indexOf("last")&&(a=a.split(" "),a[1]=Math.round(a[1]/2),document.getElementById("startInput").value=a.join(" "))}
function evalExportDecimation(){var a="";if(document.getElementById("exportMaxmin").checked||document.getElementById("exportMean").checked||document.getElementById("exportAvg").checked)a="&decimation=",0<document.getElementById("exportSamplesNumber").value&&(a+=document.getElementById("exportSamplesNumber").value),document.getElementById("exportMaxmin").checked&&(a+=",maxmin"),document.getElementById("exportMean").checked&&(a+=",mean"),document.getElementById("exportAvg").checked&&(a+=",avg");return a}
function refreshExportLink(){document.getElementById("timestampBlock").style.display="inline";document.getElementById("exportIgor").checked&&(document.getElementById("timestampBlock").style.display="none");var a=document.getElementById("tsLabel").value.length?"&tsLabel="+document.getElementById("tsLabel").value:"";a+=document.getElementById("nullValue").value.length?"&nullValue="+document.getElementById("nullValue").value:"";a+=document.getElementById("timestamp").checked?"&timestamp":"";"json"===
exportFormat?(document.getElementById("exportLink").innerHTML=jsonURL,document.getElementById("exportLink").setAttribute("onClick","javascript: location='"+jsonURL+"'")):(expu=exportURL+"&format="+exportFormat+exportBlanks+exportDecimation+a,document.getElementById("exportLink").innerHTML=expu.split("&").join("&amp;"),document.getElementById("exportLink").setAttribute("onClick","javascript: location='"+exportURL+"&format="+exportFormat+exportBlanks+exportDecimation+a+"'"))}
function plotCallback(){activePoint=-1;animationDelay=0;document.getElementById("placeholder").style.border="0px";decimationSamples=document.getElementById("decimationSamples")?document.getElementById("decimationSamples").value:"maxmin";max_event_num=document.getElementById("max_event_num")?document.getElementById("max_event_num").value:1E3;decimation=document.getElementById("decimation")?document.getElementById("decimation").value:1E3;myPlotClass=[];document.getElementById("startInput").value.length&&
(document.getElementById("start").value=document.getElementById("startInput").value);start=document.getElementById("start").value;document.getElementById("stop").value=document.getElementById("stopInput").value;stop=document.getElementById("stop").value;var a=!1,b=[],d=[];$("#tree").fancytree("getTree").visit(function(g){if(!g.folder)if(-1<g.key.indexOf("_")){var e=g.key.split("_");e.shift();var h=e.shift();"./img/y1axis.png"==g.data.icon&&d.push(h+"_"+e.join("_")+",1,1");"./img/y2axis.png"==g.data.icon&&
d.push(h+"_"+e.join("_")+",1,2");"./img/xaxis.png"==g.data.icon&&d.push(h+"_"+e.join("_")+",1,2")}else"./img/y1axis.png"==g.data.icon&&b.push(g.key+",1,1"),"./img/y2axis.png"==g.data.icon&&b.push(g.key+",1,2"),"./img/xaxis.png"==g.data.icon&&b.push(g.key+",1,2"),"./img/multi.png"==g.data.icon&&b.push(g.key+",multi"),"./img/surface.png"==g.data.icon&&(plotSurfaceTs(g.key,start,stop),b.push(g.key+",surface"),a=!0,document.getElementById("animationControls").style.display="none"),"./img/animation.png"==
g.data.icon&&(document.getElementById("animationControls").style.display="inline",frameNum=0,document.getElementById("show_chartjs").checked&&(chartjsAnimationTs(g.key,start,stop),b.push(g.key+",animation"),a=!0),document.getElementById("show_flot").checked&&(flotAnimationTs(g.key,start,stop),b.push(g.key+",animation"),a=!0),document.getElementById("show_hc").checked&&(hcAnimationTs(g.key,start,stop),b.push(g.key+",animation"),a=!0))});var f=b.join(";");document.getElementById("ts").value=f;a||(document.getElementById("animationControls").style.display=
"none");!1!==updateId&&(clearInterval(updateId),updateId=!1);a||plotTs(f,d,start,stop);add_history(0)}
function initPlot(a){a.debug&&console.log("initPlot(), $_GET",a);$("#tree")&&$("#tree").width($("#configContainer").width());for(j=0;j<events.length;j++)"undefined"!==typeof a["show_"+events[j]]&&(document.getElementById("show_"+events[j]).checked=!0,a["show_"+events[j]].length&&"1"!==a["show_"+events[j]]&&(document.getElementById("filter_"+events[j]).value=a["show_"+events[j]]));"undefined"!==typeof a.minY&&(document.getElementById("minY").value=a.minY);"undefined"!==typeof a.maxY&&(document.getElementById("maxY").value=
a.maxY);"undefined"!==typeof a.logY&&(document.getElementById("logY").value=a.logY);"undefined"!==typeof a.height&&(document.getElementById("height").value=a.height);"undefined"!==typeof a.style&&(document.getElementById("style").value=a.style);if("undefined"!==typeof a.start&&"undefined"!==typeof a.ts){document.getElementById("placeholder").style.border="0px";var b=a.start;document.getElementById("start").value=b;document.getElementById("startInput")&&(document.getElementById("startInput").value=
b);var d="";"undefined"!==typeof a.stop?(d=a.stop,document.getElementById("stopInput")&&(document.getElementById("stopInput").value=d),document.getElementById("stop").value=d):(document.getElementById("stopInput")&&(document.getElementById("stopInput").value=""),document.getElementById("stop").value="");var f=a.ts,g=[];if(0<=f.indexOf("surface"))g=f.split(","),plotSurfaceTs(g[0],b,d);else if(0<=f.indexOf("animation"))g=f.split(","),document.getElementById("animationControls").style.display="inline",
"undefined"!==typeof a.show_flot?flotAnimationTs(g[0],b,d):"undefined"!==typeof a.show_chartjs?chartjsAnimationTs(g[0],b,d):hcAnimationTs(g[0],b,d);else{if(0<=f.indexOf("_")&&0>f.indexOf("/")){f=f.split(";");for(var e=[],h=0;h<f.length;h++)0<=f[h].indexOf("_")?g.push(f[h]):e.push(f[h]);f=e.join(";")}document.getElementById("hidetree")&&(document.getElementById("hidetree").style.display="inline");"undefined"!==typeof document.getElementById("ts")&&(document.getElementById("ts").value=f);"undefined"!==
typeof a.show_chartjs?document.getElementById("show_chartjs")&&(document.getElementById("show_chartjs").checked=!0,document.getElementById("show_flot").checked=!1,document.getElementById("show_hc").checked=!1):"undefined"!==typeof a.show_flot&&document.getElementById("show_flot")&&(document.getElementById("show_flot").checked=!0,document.getElementById("show_chartjs").checked=!1,document.getElementById("show_hc").checked=!1);"undefined"!==typeof a.show_table&&document.getElementById("show_table")&&
(document.getElementById("show_table").checked=!0);a.debug&&console.log("initPlot(), plotTs",f,g,b,d);plotTs(f,g,b,d);""!=f&&add_history(0)}}}
function initTree(a){$.get(treeService+("undefined"!==typeof a.ts?"&ts="+a.ts:"")+(null!=parameters.correlation?"&correlation=1":""),function(b){if(0==b.length){var d=0<=treeService.indexOf("?")?treeService+"&host":treeService+"?host";$.get(d,function(g){var e=new Date($.now());$("body").html("<div style='margin-left: 10px;margin-top: -80px;'><h1>ERROR</h1>Cannot extract data from<br>"+g+"<br>or<br>"+treeService+"<br>"+e+'<br><a href="'+$(location).attr("href")+'">reload page</a></div>')})}localStorage.length&&
"undefined"!==typeof localStorage.csvrepo&&-1==b[0].title.indexOf(localStorage.csvrepo)&&b.unshift({title:"<span style='color: darkgreen;font-weight: bold;'>"+localStorage.csvrepo+"</span>",key:"csvrepo_"+localStorage.csvrepo,lazy:!0,folder:!0});if($("#tree").length){d=$("#treeconfig").height();150>d&&(d=150);var f=-1==document.location.search.indexOf("config_size=")?280:document.location.search.split("config_size=")[1].split("&")[0]-10;"undefined"===typeof formula_edit&&$(tree).width(f).height(d);
ftree=$("#tree").fancytree({autoScroll:!0,source:b,lazyLoad:function(g,e){e.result={url:treeService,data:{key:e.node.key}}},click:function(g,e){if("icon"==e.targetType||"title"==e.targetType)if("undefined"===typeof formula_edit){if(e.node.data.isArray)"./img/y0axis.png"==e.node.data.icon?(e.node.data.icon="./img/surface.png",e.node.data.tooltip="surface display"):"./img/surface.png"==e.node.data.icon?(e.node.data.icon="./img/animation.png",e.node.data.tooltip="animation display"):"./img/animation.png"==
e.node.data.icon?(e.node.data.icon="./img/multi.png",e.node.data.tooltip="multi line display"):"./img/multi.png"==e.node.data.icon&&(e.node.data.icon="./img/y0axis.png",e.node.data.tooltip="not selected");else if(e.node.data.isString)"./img/y0axis.png"==e.node.data.icon?(e.node.data.icon="./img/table.png",e.node.data.tooltip="show table"):"./img/table.png"==e.node.data.icon&&(e.node.data.icon="./img/y0axis.png",e.node.data.tooltip="not selected");else if(null!=parameters.correlation)if("./img/y0axis.png"==
e.node.data.icon)e.node.data.icon="./img/y1axis.png",e.node.data.tooltip="show on Y1 axis";else if("./img/y1axis.png"==e.node.data.icon)e.node.data.icon="./img/xaxis.png",e.node.data.tooltip="show on X axis";else{if("./img/xaxis.png"==e.node.data.icon||"./img/y2axis.png"==e.node.data.icon)e.node.data.icon="./img/y0axis.png",e.node.data.tooltip="not selected"}else"./img/y0axis.png"==e.node.data.icon?(e.node.data.icon="./img/y1axis.png",e.node.data.tooltip="show on Y1 axis"):"./img/y1axis.png"==e.node.data.icon?
(e.node.data.icon="./img/y2axis.png",e.node.data.tooltip="show on Y2 axis"):"./img/y2axis.png"==e.node.data.icon&&(e.node.data.icon="./img/y0axis.png",e.node.data.tooltip="not selected");e.node.data.tooltip="click to switch display mode";e.node.render(!0);e.node.parent.sortChildren()}else $.get(treeService+"&reversekey="+e.node.key,function(h){h.length&&append2formula('"'+h+'"')});return!0},clickFolderMode:2,persist:!0});updateLink()}})}
function rePlotTs(){document.getElementById("height").value.length?document.getElementById("height"):$(window).height();document.getElementById("show_flot")&&document.getElementById("show_flot").checked&&(myPlot.resize(),myPlot.draw());document.getElementById("show_chartjs")&&document.getElementById("show_chartjs").checked?(myPlot.resize(),myPlot.draw()):myPlot.reflow()}
function applyAnalysis(){"undefined"!==typeof $_GET.conf?(document.getElementById("conf").value=$_GET.conf,initConf($_GET.conf)):initConf(!1);for(var a=0;a<analysis.length;a++)if(document.getElementById(analysis[a]).checked){for(var b=[],d=0;d<document.getElementById("conf"+analysis[a]).children.length;d++)if("text"==document.getElementById("conf"+analysis[a]).children[d].type)b.push(document.getElementById("conf"+analysis[a]).children[d].name+"="+document.getElementById("conf"+analysis[a]).children[d].value);
else if("checkbox"==document.getElementById("conf"+analysis[a]).children[d].type)b.push(document.getElementById("conf"+analysis[a]).children[d].name+(document.getElementById("conf"+analysis[a]).children[d].checked?"=1":"=0"));else if("select-one"==document.getElementById("conf"+analysis[a]).children[d].type){var f=document.getElementById("conf"+analysis[a]).children[d].options.selectedIndex;b.push(document.getElementById("conf"+analysis[a]).children[d].name+"="+document.getElementById("conf"+analysis[a]).children[d].options[f].value)}d=
"";-1<document.location.search.indexOf("conf=")&&(d="conf="+document.location.search.split("conf=")[1].split("&")[0]+"&");plotService="./lib/analysis/"+analysis[a]+".php?"+d+b.join("&")}}function switch_analysis(a){for(var b=0;b<analysis.length;b++)document.getElementById("conf"+analysis[b]).style.display=a==analysis[b]&&document.getElementById(analysis[b]).checked?"block":"none",a!=analysis[b]&&(document.getElementById(analysis[b]).checked=!1)}
function initAnalysis(){$.get("./lib/analysis/analysis.php?list&conf="+$_GET.conf,function(a){a=a.split("<analysis/>");document.getElementById("analysis").innerHTML=a[0];analysis=a[1].split(",");if(-1<plotService.indexOf("analysis/")){a=plotService.split("analysis/")[1].split(".php?");document.getElementById(a[0]).checked=!0;document.getElementById("conf"+a[0]).style.display="block";var b=[],d={};-1<a[1].indexOf("&")&&(b=a[1].split("&"));-1<a[1].indexOf("%26")&&(b=a[1].split("%26"));for(var f=0;f<
b.length;f++)d[b[f].split("=")[0]]=b[f].split("=")[1];for(b=0;b<document.getElementById("conf"+a[0]).children.length;b++)"text"==document.getElementById("conf"+a[0]).children[b].type||"select-one"==document.getElementById("conf"+a[0]).children[b].type?document.getElementById("conf"+a[0]).children[b].value=d[document.getElementById("conf"+a[0]).children[b].name]:"checkbox"==document.getElementById("conf"+a[0]).children[b].type&&(document.getElementById("conf"+a[0]).children[b].checked="1"==d[document.getElementById("conf"+
a[0]).children[b].name])}})}
function applyConf(){document.getElementById("minY").value=document.getElementById("minY1set").value+";"+document.getElementById("minY2set").value;document.getElementById("maxY").value=document.getElementById("maxY1set").value+";"+document.getElementById("maxY2set").value;document.getElementById("logY").value=(document.getElementById("logY1set").checked?"1":"0")+";"+(document.getElementById("logY2set").checked?"1":"0");document.getElementById("style").value=document.getElementById("styleSet").value;var a=
document.getElementById("csvrepo").value;0<a.length?localStorage.setItem("csvrepo",a):localStorage.removeItem("csvrepo");for(var b in parameters)document.getElementById(b)&&document.getElementById(b).checked&&(optionalParam=parameters[b]=1)}
function updateConf(){minY=document.getElementById("minY").value.split(";");maxY=document.getElementById("maxY").value.split(";");logY=document.getElementById("logY").value.split(";");document.getElementById("minY1set").value=minY[0];document.getElementById("maxY1set").value=maxY[0];document.getElementById("logY1set").checked="1"==logY[0];document.getElementById("minY2set").value="undefined"===typeof minY[1]?"":minY[1];document.getElementById("maxY2set").value="undefined"===typeof maxY[1]?"":maxY[1];
document.getElementById("logY2set").checked="1"==logY[1];document.getElementById("style_scatter").selected="scatter"==document.getElementById("style").value;document.getElementById("style_step").selected="step"==document.getElementById("style").value;document.getElementById("style_line").selected="line"==document.getElementById("style").value;document.getElementById("style_spline").selected="spline"==document.getElementById("style").value}
function updateAbout(){$("body").find("#aboutVersion").html(version)}function applySearch(){var a=[];for(i=0;i<document.getElementById("Y1search").length;i++)document.getElementById("Y1search").options[i].selected&&a.push(document.getElementById("Y1search").options[i].value);for(j=0;j<document.getElementById("Y2search").length;j++)document.getElementById("Y2search").options[j].selected&&a.push(document.getElementById("Y2search").options[j].value+",1,2");updateLink(a.join(";"))}
function mysearch(){searched=document.getElementById("search").value;$.get(treeService+"&search="+searched,function(a){var b="",d;for(d in a)b+='<option value="'+d+'">'+a[d]+"</option>";$("body").find("#Y1search").html(b);$("body").find("#Y2search").html(b)})}
function change_chartjs(){document.getElementById("show_chartjs").checked&&(document.getElementById("show_hc").checked=!1,document.getElementById("show_flot").checked=!1);document.getElementById("style_item")&&(document.getElementById("style_item").style.display=document.getElementById("show_hc").checked?"inline":"none")}
function change_flot(){document.getElementById("show_flot").checked&&(document.getElementById("show_hc").checked=!1,document.getElementById("show_chartjs").checked=!1);document.getElementById("style_item")&&(document.getElementById("style_item").style.display=document.getElementById("show_hc").checked?"inline":"none")}
function change_hc(){document.getElementById("show_hc").checked&&(document.getElementById("show_flot").checked=!1,document.getElementById("show_chartjs").checked=!1);document.getElementById("style_item").style.display=document.getElementById("show_hc").checked?"inline":"none"}function csvCallback(){ts=document.getElementById("ts").value;start=document.getElementById("start").value;stop=document.getElementById("stop").value;csvTs(ts,start,stop)}
function getQueryParams(a){a=a.split("+").join(" ");for(var b={},d,f=/[?&]?([^=]+)=([^&]*)/g;d=f.exec(a);)b[decodeURIComponent(d[1])]=decodeURIComponent(d[2]);return b}
function handleFileSelect(a){var b=document.getElementById("height").value.length?document.getElementById("height").value:$(window).height()-200;$("#mybackground").width($("#plotContainer").width()-14).height(b-0-14+"px");$("#placeholder").width($("#plotContainer").width()-14).height(b+"px");document.getElementById("placeholder").style.border="0px";a.stopPropagation();a.preventDefault();a=a.dataTransfer.files[0];b=new FileReader;b.onload=function(d){return function(f){console.log("reader.onload",
f,d);csvImport.name=d.name;csvImport.lines=f.target.result.split("\n");f="";-1<csvImport.lines[0].indexOf(",")&&-1==csvImport.lines[0].indexOf(";")&&-1==csvImport.lines[0].indexOf("\t")&&(f=",",document.getElementById("separatorComma").checked=!0);-1==csvImport.lines[0].indexOf(",")&&-1<csvImport.lines[0].indexOf(";")&&-1==csvImport.lines[0].indexOf("\t")&&(f=";",document.getElementById("separatorSemicolumn").checked=!0);-1==csvImport.lines[0].indexOf(",")&&-1==csvImport.lines[0].indexOf(";")&&-1<
csvImport.lines[0].indexOf("\t")&&(f="\t",document.getElementById("separatorTab").checked=!0);""!=f&&(f=csvImport.lines[1].split(f)[0],0<f-0&&(document.getElementById("datetime").value="X"),"-"==f[4]&&"-"==f[7]&&":"==f[13]&&":"==f[16]&&(document.getElementById("datetime").value="YYYY-MM-DD HH:mm:ss"),"."==f[4]&&"."==f[7]&&"_"==f[10]&&"."==f[13]&&"."==f[16]&&(document.getElementById("datetime").value="YYYY.MM.DD_HH.mm.ss"));$("#csvModal").modal("show")}}(a);b.readAsText(a)}
function processCsv(){var a="";a=document.getElementById("separatorTab").checked?"\t":document.getElementById("separatorComma").checked?",":document.getElementById("separatorSemicolumn").checked?";":document.getElementById("separator").value;var b=document.getElementById("datetime").value,d=csvImport.lines[0].split(a);col_number=d.length-1;if(1>col_number)alert("Error: cannot detect columns using separator "+a);else{var f=1;myPlotClass=[];for(var g=0;g<col_number;g++)myPlotClass[g]=[],myPlotClass[g].data=
[],document.getElementById("show_hc")&&document.getElementById("show_hc").checked?myPlotClass[g].name=$.isNumeric(d[g+1])?"ts1"+g:d[g+1].replace(/&deg;/g,"\u00b0"):(myPlotClass[g].lines={show:!0,fill:!1},myPlotClass[g].label=$.isNumeric(d[g+1])?"ts1"+g:d[g+1]),"Y"==d[g+1].substring(0,1)&&$.isNumeric(d[g+1].substring(1,2))&&(myPlotClass[g].yAxis=d[g+1].substring(1,2)-1,myPlotClass[g].yaxis=d[g+1].substring(1,2)-0,f<d[g+1].substring(1,2)&&(f=d[g+1].substring(1,2)));var e=-1,h=document.getElementById("show_table")&&
document.getElementById("show_table").checked,k='<table class="table table-striped table-bordered table-condensed" width="100%"><thead><tr><th>timestamp</th>';for(d=0;d<col_number;d++)k+="<th>"+myPlotClass[d].label+"</th>";k+="</tr></thead><tbody>";for(var r=0,q=0;q<csvImport.lines.length;q++)if(d=csvImport.lines[q].split(a),!(2>d.length)){g=moment(d[0],b);var v=g.valueOf();if($.isNumeric(v)&&0<v){e++;0==r&&(r=v);k+="<tr><td>"+g.toString()+"</td>";for(g=0;g<col_number;g++)k+="<td>"+d[g+1]+"</td>",
""!==d[g+1]&&(myPlotClass[g].data[e]=[v,parseFloat(d[g+1])]);k+="</tr>"}}stop=v;if(document.getElementById("show_hc")&&document.getElementById("show_hc").checked){e="step";document.getElementById("style")&&document.getElementById("style").value.length&&(e=document.getElementById("style").value);e={chart:{renderTo:document.getElementById("placeholder"),type:"line",height:document.getElementById("height").value.length?document.getElementById("height").value:$(window).height()-200},title:{text:"eGiga2m"},
xAxis:{type:"datetime"},yAxis:[],tooltip:{headerFormat:"<b>{series.name}</b><br>",pointFormat:"{point.x:%d/%m/%Y %H:%M:%S}: {point.y:.9f} "},type:"step"==e?"line":e,series:myPlotClass};Highcharts.setOptions({global:{useUTC:!1}});for(d=1;d<=f;d++)e.yAxis[d-1]={title:{text:"Y"+d},opposite:2==f&&2==d};myPlot=f=new Highcharts.Chart(e)}else document.getElementById("show_flot")&&document.getElementById("show_flot").checked?($("#mybackground").height("1px"),f={series:{lines:{show:!0}},grid:{hoverable:!0,
clickable:!0},xaxis:{zoomRange:[.01,12E7],panRange:[r,stop],mode:"time",tickLength:5},yaxes:[{},{position:"right"}],legend:{position:"nw"},canvas:!0},myPlot=f=$.plot($("#placeholder"),myPlotClass,f)):document.getElementById("show_chartjs")&&document.getElementById("show_chartjs").checked?($("#mybackground").height("1px"),f={scales:{xAxes:[{type:"time",time:{format:timeFormat,tooltipFormat:timeFormat},scaleLabel:{display:!0,labelString:"Date"},ticks:{callback:function(l,m,n){return m==n.length-1?"":
moment(n[m]?n[m]._i:0).format("DD/MM/Y")}}}],yAxes:[{scaleLabel:{display:!0,labelString:"value"}}]}},myPlot=f=$.plot($("#placeholder"),myPlotClass,f)):($("#mybackground").height("1px"),$("#placeholder").height("1px"),document.getElementById("placeholder").innerHTML="");k+="</tbody></table>";document.getElementById("tableContainer").innerHTML=h?k:"";document.getElementById("pdfExport")&&(document.getElementById("pdfExport").style.display="none");0<document.getElementById("retain").value.length&&$.post("./lib/service/csv_service.php",
{name:csvImport.name,content:csvImport.lines.join("\n"),separator:a,timeformat:b,db:document.getElementById("retain").value},dataImported)}}function dataImported(a){-1<a.indexOf("ok")&&localStorage.setItem("csvrepo",document.getElementById("retain").value);console.log("CSV repo",a)}
function handleTreeSelect(a){a.stopPropagation();a.preventDefault();attr=extractTimeseries(a.dataTransfer.getData("text"));addTs="copy"==a.dataTransfer.dropEffect;$.get(treeService+"&searchkey="+attr,function(b){"undefined"!==typeof b[0]&&(b=addTs&&document.getElementById("ts").value.length?document.getElementById("ts").value+";"+b[0]:b[0],updateLink(b),document.getElementById("ts").value=b)})}function handleDragOver(a){a.stopPropagation();a.preventDefault();a.dataTransfer.dropEffect="plot"}
var dropZone=document.getElementById("plotContainer");dropZone.addEventListener("dragover",handleDragOver,!1);dropZone.addEventListener("drop",handleFileSelect,!1);if($("#tree").length){var dropTree=document.getElementById("tree");dropTree.addEventListener("dragover",handleDragOver,!1);dropTree.addEventListener("drop",handleTreeSelect,!1)}
function fillTable(a){var b="",d=[],f=[];b='<br><table class="table table-striped table-bordered table-condensed" width="100%"><thead><tr><th>time</th>';for(var g=0,e=0;e<a.length;e++)"clone"!=e&&"undefined"!==typeof a[e].label&&(g=e-0+1);for(e=0;e<a.length;e++)if("clone"!=e&&"undefined"!==typeof a[e].label){b+="<th>"+a[e].label+"</th>";for(var h=0;h<a[e].data.length;h++)"undefined"!==typeof a[e].data[h][0]&&("undefined"===typeof d[a[e].data[h][0]]&&(d[a[e].data[h][0]-0]=Array(g),f.push(a[e].data[h][0]-
0)),d[a[e].data[h][0]][e]=a[e].data[h][1])}b+="</tr></thead>\n<tbody>\n";f.sort(function(k,r){return k-r});for(h=0;h<f.length;h++)if(f[h]-0==f[h]&&"undefined"!==typeof f[h]&&"clone"!=f[h]){b+="<tr>";b+="<td>"+(new Date(f[h])).format("Y-m-d H:i:s")+"</td>";for(e=0;e<g;e++)b+="<td>"+("undefined"!==typeof d[f[h]]&&"undefined"!==typeof d[f[h]][e]?d[f[h]][e]:"&nbsp;")+"</td>";b+="</tr>\n"}b+="</tbody></table>";document.getElementById("tableContainer")&&(document.getElementById("tableContainer").innerHTML=
b)}function timeZoom(a,b,d){d=(d-a)/zoom_speed;a=1;864E6<d?a=864E5:3456E5<d?a=216E5:108E5<d?a=36E5:9E5<d&&(a=6E4);d=Math.round(d/a)*a;a*=Math.round((b-d/2)/a);b=new Date(a+d);return[(new Date(a)).format("Y-m-d H:i:s"),b.format("Y-m-d H:i:s")]}
function add_history(a){if(!(-1>myHistoryCounter+a&&myHistoryCounter+a>=myHistory.length)){myHistoryCounter+=a;if(0==a)myHistoryCounter+=1,myHistory.length=myHistoryCounter,myHistory[myHistoryCounter]=updateLink("history");else{a=getQueryParams(myHistory[myHistoryCounter]);plotTs(a.ts,[],a.start,"undefined"===typeof a.stop?"":a.stop);var b=["minY","maxY","logY","height","style"];for(c=0;c<b.length;c++)document.getElementById(b[c]).value="undefined"===typeof a[b[c]]?"":a[b[c]]}document.getElementById("myBack").style.display=
1>myHistoryCounter?"none":"inline";document.getElementById("myFwd").style.display=myHistoryCounter==myHistory.length-1?"none":"inline"}}function decodeTs(a){for(var b=a.split(";"),d=0;d<b.length;d++){var f=b[d].split(",");curves[d]={request:f[0],x:f[1],y:f[2],response:f[0]};-1<document.location.search.indexOf("replacets=false")&&(curves[d+b.length]={request:f[0],x:f[1],y:f[2],response:f[0]})}return a}
function newdecodeTs(a){a=a.split(";");for(var b=[],d=[],f=[],g,e=0;e<a.length;e++){g=-1;var h=a[e].split(",");"undefined"===typeof h[1]&&(h[1]=1);"undefined"===typeof h[2]&&(h[2]=1);if(-1<h[0].indexOf("$"))for(var k=h[0].split("$"),r=0;r<k.length;r++)r%2&&-1==d.indexOf(k[r]+","+h[1])&&(d.push(k[r]+","+h[1]),f.push(k[r]));else g=b.push(h[0]+","+h[1])-1;curves[e]={request:h[0],x:h[1],y:h[2],response:0<=g?g:f}}return b.concat($(d).not(b).get()).join(";")}function SortByTime(a,b){return a.x-b.x}
function strtr(a,b){var d,f;for(f in b)for(d="";a!==d;)d=a,a=d.replace(f,b[f]);return a}function mathEval(a){var b=!0;a=a.replace(/(?:[a-z$_][a-z0-9$_]*)|(?:[;={}\[\]"'!&<>^\\?:])/ig,function(d){if(Math.hasOwnProperty(d))return"Math."+d;b=!1});if(!b)return NaN;try{return eval(a)}catch(d){return NaN}}
function evalFormulae(a){if(null!=parameters.correlation&&1<a.length){var b;for(b=0;b<a.length&&"2"!=a[b].yaxis;b++);for(var d,f=0;f<a.length;f++)if(f!=b){var g;d=[];for(var e=0;e<a[f].data.length;e++){for(g=0;"undefined"!=typeof a[b].data[g]&&("undefined"==typeof a[b].data[g][0]||a[b].data[g][0]<a[f].data[e][0]);)g++;0<g&&"undefined"!=typeof a[b].data[g-1]&&"undefined"!=typeof a[b].data[g-1][1]&&d.push([a[b].data[g-1][1],a[f].data[e][1],a[b].data[g-1][0]])}a[f].data=d;a[f].display_unit="<b>"+a[b].label+
"</b>"}a.splice(b,1);curves.splice(b,1)}return a}
function plotTs(a,b,d,f){$_GET.debug&&console.log("plotTs(), tsRequest",a,"ts2",b);curves=[];myRequest=a;var g="";for(j=0;j<events.length;j++)g+=document.getElementById("show_"+events[j]).checked?"&show_"+events[j]+"="+document.getElementById("filter_"+events[j]).value:"";g=g+"&decimation="+decimation+"&decimation_samples="+decimationSamples+"&max_event_num="+max_event_num;if(document.getElementById("hideOverMaxmin")&&document.getElementById("hideOverMaxmin").checked){g+="&hideOverMaxmin=";var e=
document.getElementById("maxY").value;1<e.length&&(g+="&maxY="+e);e=document.getElementById("minY").value;1<e.length&&(g+="&minY="+e)}e=document.getElementById("height").value.length?document.getElementById("height").value:$(window).height()-200;300>e&&(e=300);document.getElementById("show_hc")&&document.getElementById("show_hc").checked||(e=15);var h=$(window).width()-(0<$("#tree").length?280:0);300>h&&(h=300);$("#mybackground").width(h-14).height(e-0-14+"px");$("#placeholder").width(h-14).height(e+
"px");$("#placeholder").html("&nbsp;&nbsp;&nbsp;&nbsp;<img src='./img/timer.gif'>");var k="start="+d,r="";updatePlot=0;0<=f.indexOf("update")?(e=f.split(","),updatePlot="undefined"===typeof e[1]?1:.1<e[1]?e[1]:.1,updateBackground="undefined"===typeof e[2]?300:60<e[2]?e[2]:60,r="&no_posttimer="):f.length&&(r="&stop="+f);var q=document.getElementById("show_hc").checked?"&prestart=hc":"",v=f.length?new Date(f):new Date;$.get(plotService+"&Seconds_Behind_Master",function(l){60<l&&alert("WARNING\nThe data has not been updated for "+
l+" seconds")});$_GET.debug&&console.log("ts",a,"ts2",b);1>a.length+b.length?$("#placeholder").html("&nbsp;&nbsp;&nbsp;&nbsp;<h4>WARNING: No Time Series has been requested</h4>Please select e Time Series and a time period"):$_GET.debug&&console.log("plotService",plotService);0<a.length&&0<b.length?(curves=[],-1<plotService.indexOf("analysis/")?$.getJSON(plotService+"&"+k+r+"&ts="+a+";"+b.join(";")+q+g,function(l){for(var m=0;m<l.ts.length;m++)curves.push({request:l.ts[m].ts_id,x:""+l.ts[m].xaxis,
y:l.ts[m].yaxis,response:m});plotData(evalFormulae(l.ts),l.event,l.forecast,d,f)}):(b=["./lib/service/csv_service.php?"+k+r+"&ts="+b.join(";")+g,plotService+"&"+k+r+"&ts="+a+q+g],Promise.all(b.map(function(l){return fetch(l).then(function(m){return m.json()})})).then(function(l){for(var m=0;m<l[0].ts.length;m++)curves.push({request:l[0].ts[m].ts_id,x:""+l[0].ts[m].xaxis,y:l[0].ts[m].yaxis,response:m});for(m=0;m<l[1].ts.length;m++)curves.push({request:l[1].ts[m].ts_id,x:""+l[1].ts[m].xaxis,y:l[1].ts[m].yaxis,
response:l[1].ts[m].ts_id});plotData(evalFormulae(l[0].ts.concat(l[1].ts)),l[1].event,l[0].forecast?l[0].forecast.concat(l[1].forecast):l[1].forecast,d,f)}))):0<b.length?$.getJSON((-1<plotService.indexOf("analysis/")?plotService+"&":"./lib/service/csv_service.php?")+k+r+"&ts="+b.join(";")+g,function(l){for(var m=0;m<l.ts.length;m++)curves.push({request:l.ts[m].ts_id,x:""+l.ts[m].xaxis,y:l.ts[m].yaxis,response:m});plotData(evalFormulae(l.ts),l.event,l.forecast,d,f)}).fail(function(l,m,n){console.log("fail",
l,m,n);alert(m);alert(n);document.getElementById("placeholder").innerHTML="&nbsp;&nbsp;&nbsp; ERROR: no data found, please double check start, stop and timeseries selection, "+m+" - "+n}).always(function(){"undefined"!=typeof document.getElementById("placeholder").children[0]&&(document.getElementById("placeholder").children[0].src="")}):0<a.length&&$.get(plotService+"&"+k+r+"&ts="+a+q+g,function(l){$_GET.debug&&console.log("$.get data",l,".get()",plotService+"&"+k+r+"&ts="+a+q+g);for(var m=0;m<l.ts.length;m++)curves.push({request:l.ts[m].ts_id,
x:""+l.ts[m].xaxis,y:l.ts[m].yaxis,response:l.ts[m].ts_id});for(var n=m=0;n<l.ts.length;n++)m+=l.ts[n].num_rows;0==m&&$("#placeholder").html("&nbsp;&nbsp;&nbsp;&nbsp;<h4>WARNING: No data available</h4>Please select e Time Series and a time period containing some data");if(document.getElementById("downtimeCheck")&&document.getElementById("downtimeCheck").checked){n=l.ts[0].data[0].x?l.ts[0].data[0].x:l.ts[0].data[0][0];for(var t=[],A=0;A<l.ts.length;A++)m+=l.ts[A].num_rows,(v.valueOf()-l.ts[A].data[l.ts[A].data.length-
1][0])/(v.valueOf()-n)>10/l.ts[A].data.length&&t.push(l.ts[A].label);t.length&&alert("WARNIG\nsome data may be missing (may be server or replication downtime) for Time Series:\n"+t.join(","))}plotData(evalFormulae(l.ts),l.event,l.forecast,d,f)}).fail(function(l,m,n){console.log("fail",l.status,m,n);document.getElementById("placeholder").innerHTML="&nbsp;&nbsp;&nbsp; ERROR: "+l.status+" "+n}).always(function(){"undefined"!=typeof document.getElementById("placeholder").children[0]&&(document.getElementById("placeholder").children[0].src=
"")})}
function plotData(a,b,d,f,g){f=f.split(";");g=g.split(";");$_GET.debug&&console.log("plotData, dataTs:",a);document.getElementById("show_hc").checked?(hcPlot(a,b,d,f,g),document.getElementById("pdfExport")&&(document.getElementById("pdfExport").style.display="inline")):document.getElementById("show_chartjs").checked?(chartjsPlot(a,b,d,f,g),document.getElementById("pdfExport")&&(document.getElementById("pdfExport").style.display="none")):document.getElementById("show_flot").checked?(flotPlot(a,b,f,
g),document.getElementById("pdfExport")&&(document.getElementById("pdfExport").style.display="none")):($("#mybackground").height("1px"),$("#placeholder").height("1px"),document.getElementById("placeholder").innerHTML="");if(document.getElementById("show_table").checked)fillTable(a);else{b=0;tableData=[];for(d=0;d<a.length;d++)a[d].isString&&(tableData[b++]=a[d]);b&&fillTable(tableData)}}var oldtime="";
function chartjsPlot(a,b,d,f,g){window.myLine&&window.myLine.destroy();for(q=0;q<events.length;q++)document.getElementById("event_"+events[q]).style.display="none";f="step";document.getElementById("style")&&document.getElementById("style").value.length&&(f=document.getElementById("style").value);g=[window.chartColors.blue,window.chartColors.red,window.chartColors.green,window.chartColors.orange,window.chartColors.magenta,window.chartColors.brown];var e=document.getElementById("minY")&&document.getElementById("minY").value.length?
document.getElementById("minY").value.split(";"):[""],h=document.getElementById("maxY")&&document.getElementById("maxY").value.length?document.getElementById("maxY").value.split(";"):[""],k=document.getElementById("logY")&&document.getElementById("logY").value.length?document.getElementById("logY").value.split(";"):["0"],r=Chart.helpers.color;b={legend:{position:"bottom"},radius:20,maintainAspectRatio:!1,scales:{xAxes:[{type:"time",time:{format:"HH:mm:ss",tooltipFormat:"HH:mm:ss"},scaleLabel:{display:!0,
labelString:"Time"},ticks:{callback:function(l,m,n){if(m==n.length-1)return"";l=moment(n[m]?n[m]._i:0).format("HH:mm:ss");"00:00:00"==l?l=moment(n[m]?n[m]._i:0).format("DD/MM/Y"):""!=oldtime&&moment(oldtime).format("DDD")!=moment(n[m]?n[m]._i:0).format("DDD")&&(l=moment(n[m]?n[m]._i:0).format("DD/MM/Y ")+l);oldtime=n[m]?n[m]._i:0;return l}}}],yAxes:[{id:"y1",type:"linear",position:"left",ticks:{}},{id:"y2",type:"linear",position:"right",grid:!1,ticks:{}}]}};""!=e[0]&&(b.scales.yAxes[0].ticks.min=
e[0]-0);""!=h[0]&&(b.scales.yAxes[0].ticks.max=h[0]-0);"0"!=k[0]&&(b.scales.yAxes[0].type="logarithmic");1<e.length&&""!=e[1]&&(b.scales.yAxes[1].ticks.min=e[1]-0);1<h.length&&""!=h[1]&&(b.scales.yAxes[1].ticks.max=h[1]-0);1<k.length&&"0"!=k[1]&&(b.scales.yAxes[1].type="logarithmic");e=[];h=!1;for(var q=0;q<a.length;q++){var v=[];for(k=0;k<a[q].data.length;k++)v.push({x:a[q].data[k][0],y:a[q].data[k][1]});"2"==a[q].yaxis&&(h=!0);e.push({label:a[q].label,backgroundColor:r(g[q%g.length]).alpha(.5).rgbString(),
borderColor:g[q%g.length],fill:-1<f.indexOf("area"),pointStyle:"scatter"==f?"circle":"line",showLine:"scatter"!=f,lineTension:"line"==f||"area"==f?0:.8,cubicInterpolationMode:"monotone",steppedLine:"step"==f,data:v,yAxisID:"y"+("multi"==a[q].yaxis?"1":a[q].yaxis)})}if("undefined"!=typeof d){b.legend.labels={filter:function(l,m){return!l.text.includes("forecast ")}};v=[];for(k=0;k<d.fv.length;k++)v.push({x:d.fv[k][0],y:d.fv[k][1]});e.push({label:"Forecast",data:v,backgroundColor:r(g[1]).alpha(.5).rgbString(),
borderColor:g[1],fill:!1,pointStyle:"line",showLine:!0,lineTension:.8,cubicInterpolationMode:"monotone",steppedLine:!1});a=[];f=[];for(k=0;k<d.f80.length;k++)a.push({x:d.f80[k][0],y:d.f80[k][1]}),f.push({x:d.f80[k][0],y:d.f80[k][2]});e.push({label:"forecast 80%",data:a,color:"pink",borderColor:"pink",fill:!1,pointStyle:"line",showLine:!0,lineTension:0,cubicInterpolationMode:"monotone",steppedLine:!1});e.push({label:"forecast 80%",data:f,color:"pink",borderColor:"pink",backgroundColor:"pink",fill:"-1",
pointStyle:"line",showLine:!0,lineTension:0,cubicInterpolationMode:"monotone",steppedLine:!1});a=[];f=[];for(k=0;k<d.f95.length;k++)a.push({x:d.f95[k][0],y:d.f95[k][1]}),f.push({x:d.f95[k][0],y:d.f95[k][2]});e.push({label:"forecast 95%",data:a,borderColor:"mistyrose",color:"mistyrose",fill:!1,pointStyle:"line",showLine:!0,lineTension:0,cubicInterpolationMode:"monotone",steppedLine:!1});e.push({label:"forecast 95%",data:f,color:"mistyrose",borderColor:"mistyrose",backgroundColor:"mistyrose",fill:"-1",
pointStyle:"line",showLine:!0,lineTension:0,cubicInterpolationMode:"monotone",steppedLine:!1})}h||b.scales.yAxes.pop();d={type:"line",data:{datasets:e},options:b};$("#canvas").show();$("#placeholder").hide();a=document.getElementById("canvas").getContext("2d");window.myLine=new Chart(a,d)}
function flotPlot(a,b,d,f){$("#canvas").hide();$("#placeholder").show();b={series:{lines:{show:!0}},grid:{hoverable:!0,clickable:!0},xaxes:[{zoomRange:[.01,12E7],panRange:[13700376E5,14015736E5],mode:"time",timezone:"browser",tickLength:5}],yaxes:[{},{position:"right"}],legend:{position:"sw"},canvas:!0};myPlotClass=[];for(var g=document.getElementById("minY")&&document.getElementById("minY").value.length?document.getElementById("minY").value.split(";"):[],e=document.getElementById("maxY")&&document.getElementById("maxY").value.length?
document.getElementById("maxY").value.split(";"):[],h=document.getElementById("logY")&&document.getElementById("logY").value.length?document.getElementById("logY").value.split(";"):[],k=1,r=1,q=0;q<a.length;q++)"undefined"!==typeof a[q].label&&(myPlotClass[q]=[],myPlotClass[q].label=a[q].label,myPlotClass[q].xaxis=a[q].xaxis-0,myPlotClass[q].yaxis=a[q].yaxis-0,myPlotClass[q].data=a[q].data,myPlotClass[q].lines={show:!0,fill:!1},k<a[q].xaxis&&(k=a[q].xaxis),r<a[q].yaxis&&(r=a[q].yaxis));for(a=1;a<=
r;a++)h[a-1]&&"1"==h[a-1]?(b.yaxes[a-1].transform=function(v){return 0<v?Math.log(v):-23},b.yaxes[a-1].inverseTransform=function(v){return Math.exp(v)}):(b.yaxis||(b.yaxis=[]),b.yaxis[a-1]={},g[a-1]&&(b.yaxis[a-1].min=g[a-1]),e[a-1]&&(b.yaxis[a-1].max=e[a-1]));myPlot=$.plot($("#placeholder"),myPlotClass,b);$("#placeholder").append('<div style="position:absolute;left:120px;top:10px;color:#676;font-size:smaller">eGiga2m - '+d+" - "+f+"</div>");document.getElementById("pdfExport")&&(document.getElementById("pdfExport").style.display=
"none");document.getElementById("hidetree")&&(document.getElementById("hidetree").style.display="inline")}function showTooltip(a,b,d){$('<div id="tooltip">'+d+"</div>").css({position:"absolute",display:"none",top:b+5,left:a+5,border:"1px solid #fdd",padding:"2px","background-color":"#fee",opacity:.8}).appendTo("body").fadeIn(200)}var previousPoint=null;
$("#placeholder").bind("plothover",function(a,b,d){"undefined"!==typeof b.x&&$("#x").text(b.x.toFixed(2));"undefined"!==typeof b.y&&$("#y").text(b.y.toFixed(2));d?previousPoint!=d.dataIndex&&(previousPoint=d.dataIndex,$("#tooltip").remove(),showTooltip(d.pageX,d.pageY,"&nbsp;&nbsp;"+d.datapoint[1]+"<br>&nbsp;&nbsp;"+(new Date(d.datapoint[0]-0)).toLocaleString())):($("#tooltip").remove(),previousPoint=null)});
$("#placeholder").bind("plotclick",function(a,b,d){if(document.getElementById("startInput")){for(a=0;"undefined"===typeof myPlotClass[0].data[a][0];)a++;startStop=timeZoom(myPlotClass[0].data[a][0],b.x,myPlotClass[0].data[myPlotClass[0].data.length-1][0]);document.getElementById("startInput").value=document.getElementById("start").value=startStop[0];document.getElementById("stopInput").value=document.getElementById("stop").value=startStop[1];plotTs(myRequest,[],startStop[0],startStop[1]);add_history(0)}else-1==
document.location.search.indexOf("noclick")&&(document.location="./index.html"+document.location.search)});var printing=!1;
function hcPlot(a,b,d,f,g){$("#canvas").hide();$("#placeholder").show();if(b&&b.error&&b.error.warning){var e=0<b.error.warning.length?"<span style='color:red;'>WARNING: reached max number of errors.</span>":"";for(p=0;p<b.error.warning.length;p++)(new Date(0)).setUTCSeconds(b.error.warning[p]/1E3),e=e+"<br>errors are ignored after "+getFormattedDate(b.error.warning[p])+" for timeseries # "+p;$("#event_error").html("<img src='./img/event_error.png'>&nbsp;Errors&nbsp;"+e)}else console.log("no warnings");
$_GET.debug&&console.log("hcPlot(), data",a,"curves",curves);p="No data available in selected period";var h=document.getElementById("height").value.length?document.getElementById("height").value:$(window).height()-200;300>h&&(h=300);var k="step",r=[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],q=document.getElementById("minY")&&document.getElementById("minY").value.length?document.getElementById("minY").value.split(";"):[],v=document.getElementById("maxY")&&document.getElementById("maxY").value.length?document.getElementById("maxY").value.split(";"):
[],l=document.getElementById("logY")&&document.getElementById("logY").value.length?document.getElementById("logY").value.split(";"):[];document.getElementById("style")&&document.getElementById("style").value.length&&(k=document.getElementById("style").value);var m=1;e=1;for(var n=0;n<a.length;n++)curves[n].request=a[n].ts_id,e<curves[n].y&&(e=curves[n].y);var t=0;for(n=0;n<events.length;n++)document.getElementById("event_"+events[n]).style.display="none";myPlotClass=[];for(n in curves)if("clone"!=
n)if($_GET.debug&&console.log("kk",t,"j",n,"data[kk]",a[t]),a)for(;a[t]&&a[t].ts_id.split("[")[0]==curves[n].request;){var A=a[t].query_time?a[t].query_time:0,C=0<A?", Samples per second: "+(a[t].num_rows/A).toFixed(0):"";A="Samples: "+a[t].data.length+(a[t].num_rows>a[t].data.length?"/"+a[t].num_rows:"")+(a[t].query_time?", query time: "+A.toFixed(2)+" [s]"+C:"");"undefined"!==typeof y&&"undefined"!==typeof y[t]||a[t].label.replace(/&deg;/g,"\u00b0");myPlotClass.push({shortName:"undefined"!==typeof y&&
"undefined"!==typeof y[t]?y[t]:(1<e?"Y"+(curves[n].y?curves[n].y:1)+" ":"")+a[t].label.replace(/&deg;/g,"\u00b0"),name:'<span title="'+A+'">'+("undefined"!==typeof y&&"undefined"!==typeof y[t]?y[t]:(1<e?"Y"+(curves[n].y?curves[n].y:1)+" ":"")+a[t].label.replace(/&deg;/g,"\u00b0"))+"</span>",xAxis:a[t].xaxis-1,yAxis:$.isNumeric(curves[n].y)?curves[n].y-1:0,data:a[t].data,visible:"undefined"!==typeof visible[t]?"true"==visible[t]:!0,step:"step"==k?"left":!1});m<a[t].xaxis&&(m=a[t].xaxis);"undefined"!==
typeof a[t].categories&&(r[a[t].yaxis-1]=a[t].categories);a[t].ranges&&myPlotClass.push({name:"Range",data:a[t].ranges,type:"arearange",lineWidth:0,linkedTo:":previous",color:Highcharts.getOptions().colors[t],fillOpacity:.5,zIndex:0,marker:{enabled:!1}});t++}else p="No variable selected";"undefined"!=typeof d&&(myPlotClass.push({name:"Forecast",data:d.fv,color:"red",zIndex:1}),myPlotClass.push({name:"Forecast 80%",data:d.f80,type:"arearange",lineWidth:0,linkedTo:":previous",color:"pink",opacity:.4,
fillOpacity:.4,zIndex:0,marker:{enabled:!1}}),myPlotClass.push({name:"Forecast 95%",data:d.f95,type:"arearange",lineWidth:0,linkedTo:":previous",color:"lightpink",opacity:.3,fillOpacity:.3,zIndex:-1,marker:{enabled:!1}}));if(b)for(n in b)"clone"!=n&&b[n]&&"undefined"!==typeof fade_level[n]&&"undefined"===typeof b[n].label&&(myPlotClass.push({name:n,showInLegend:!1,xAxis:0,yAxis:0,data:b[n].data,type:"scatter",step:!1}),document.getElementById("event_"+n).style.display="inline");if("undefined"!==typeof window.$_GET.tsLabel){var y=
window.$_GET.tsLabel.split(";");for(n in a)myPlotClass[n].name="undefined"!==typeof y[n]?y[n]:y[0]}d={credits:{enabled:!1},exporting:{url:hcExportService},legend:{useHTML:!0},chart:{events:{beforePrint:function(){window.printing=!0},afterPrint:function(){window.printing=!0},click:function(x){if(!window.printing)if($("#plotContainer").width(),document.getElementById("startInput")){for(var z=0;"undefined"===typeof myPlotClass[0].data[z][0];)z++;startStop=timeZoom(myPlotClass[0].data[z][0],x.xAxis[0].value,
myPlotClass[0].data[myPlotClass[0].data.length-1][0]);document.getElementById("startInput").value=document.getElementById("start").value=startStop[0];document.getElementById("stopInput").value=document.getElementById("stop").value=startStop[1];plotTs(myRequest,[],startStop[0],startStop[1]);add_history(0)}else-1==document.location.search.indexOf("noclick")&&(document.location=document.location.pathname.match(/[^\/]+$/)[0].replace("_plot.html",".html")+document.location.search);window.printing=!1},
load:function(){if(updatePlot&&0!=updateService.length){for(var x=[],z=0;z<myPlotClass.length;z++)if("clone"!=z){var u=myPlotClass[z].shortName;"Y"==u.substring(0,1)&&$.isNumeric(u.substring(1,2))&&(u=u.substring(3));x[z]=u}updateRequest=updateService+x.join(",");updateId=setInterval(function(){if(updateDecimation){if(0<updateCounter){updateCounter--;return}updateCounter=updateDecimation}$.get(updateRequest,function(w){for(var B in w)"clone"!=B&&15E11<w[B][0]&&myPlot.series[B].addPoint(w[B],!0,!1)})},
1E3*updatePlot)}}},renderTo:placeholder,type:"step"==k?"line":k,height:h},title:{text:"eGiga2m"},plotOptions:{series:{animation:!updatePlot,turboThreshold:4E3}},xAxis:[],yAxis:[],tooltip:{headerFormat:"<b>{series.name}</b><br>",pointFormat:"{point.x:%d/%m/%Y %H:%M:%S}: {point.y:.3f} ",formatter:function(){if(-1==activePoint)activePoint=0;else{activePoint=this.series.data.indexOf(this.point);var x=new Date(this.x),z="";if(null!=parameters.correlation)for(var u=0;u<myPlotClass[0].data.length;u++)if(myPlotClass[0].data[u][0]==
this.x)return x=new Date(myPlotClass[0].data[u][2]),x.format("Y-m-d H:i:s")+" x: "+myPlotClass[0].data[u][0]+" y: "+myPlotClass[0].data[u][1];for(var w=0;w<myPlotClass.length;w++){myPlotClass[w].name==this.series.name&&this.x==myPlotClass[w].data[0].x&&"undefined"!==typeof myPlotClass[w].data[0].prestart&&(x=new Date(myPlotClass[w].data[0].prestart),z=" pre-start");if(myPlotClass[w].name==this.series.name&&"error"==this.series.name)for(u in myPlotClass[w].data)if(myPlotClass[w].data[u].x==this.x)return"<b>error</b><br><br>"+
a[myPlotClass[w].data[u].message].label+"<br>"+x.format("Y-m-d H:i:s")+z+": <b><br>"+b.error.message[myPlotClass[w].data[u].message]+"</b>";if(myPlotClass[w].name==this.series.name&&"undefined"!==typeof fade_level[this.series.name])for(u in myPlotClass[w].data)if(myPlotClass[w].data[u].x==this.x)return"<b>"+this.series.name+"</b><br>"+x.format("Y-m-d H:i:s")+": <b><br>"+b[this.series.name].message[myPlotClass[w].data[u].message]+"</b>";myPlotClass[w].name==this.series.name&&this.x==myPlotClass[w].data[myPlotClass[w].data.length-
1].x&&"undefined"!==typeof myPlotClass[w].data[myPlotClass[w].data.length-1].poststart&&this.tooltip.hide()}return"<b>"+this.series.name+"</b><br>"+x.format("Y-m-d H:i:s")+z+": <b>"+this.y+"</b>"}}},lang:{noData:p},noData:{style:{fontWeight:"bold",fontSize:"15px",color:"#303030"}},series:myPlotClass};for(var p=1;p<=m;p++)d.xAxis[p-1]={type:null==parameters.correlation&&-1==curves[0].request.indexOf("FFT")?"datetime":"linear",gridLineWidth:0,lineColor:"#000",title:{text:f[p-1]+" - "+g[p-1]},opposite:2==
m&&2==p};"undefined"!==typeof window.$_GET.hideMenu&&(d.navigation={buttonOptions:{enabled:!1}});if("undefined"!==typeof window.$_GET.plotLines){f=window.$_GET.plotLines.split(";");g=[];for(p=0;p<f.length;p++)y=f[p].split(","),g.push({color:2<y.length?y[2]:"#FF0000",width:1<y.length?y[1]:1,value:y[0]});d.xAxis[0].plotLines=g}if("undefined"!==typeof window.$_GET.xShow)for(f=window.$_GET.xShow.split(";"),p=1;p<=m;p++)"0"==("undefined"!==typeof f[p-1]?f[p-1]:f[0])&&(d.xAxis[p-1].lineWidth=0,d.xAxis[p-
1].labels={enabled:!1});if("undefined"!==typeof window.$_GET.xLabel||"undefined"!==typeof window.$_GET.xlabel)for(f=("undefined"!==typeof window.$_GET.xLabel?window.$_GET.xLabel:window.$_GET.xlabel).split(";"),p=1;p<=m;p++)d.xAxis[p-1].title={text:"undefined"!==typeof f[p-1]?f[p-1]:f[0]};"undefined"!==typeof window.$_GET.title&&(d.title={text:window.$_GET.title});for(p=d.xAxis[0].gridLineWidth=1;p<=e;p++)d.yAxis[p-1]={title:{text:"Y"+(p?p:1)},opposite:2==e&&2==p},q[p-1]&&(d.yAxis[p-1].min=q[p-1]),
v[p-1]&&(d.yAxis[p-1].max=v[p-1]),l[p-1]&&"1"==l[p-1]&&(d.yAxis[p-1].type="logarithmic"),d.yAxis[p-1].labels={formatter:function(){return this.value}},r[p-1]&&(d.yAxis[p-1].categories=r[p-1]);if("undefined"!==typeof window.$_GET.yLabel)for(r=window.$_GET.yLabel.split(";"),p=1;p<=e;p++)d.yAxis[p-1].title={text:"undefined"!==typeof r[p-1]?r[p-1]:r[0]?r[0]:""};else{ylab=[];for(n in curves)"clone"!=n&&(ylab[a[n].yaxis]?ylab[a[n].yaxis].push(a[n].display_unit):ylab[a[n].yaxis]=[a[n].display_unit]);for(e=
1;e<ylab.length;e++){ylab[e]||$("#placeholder").html("&nbsp;&nbsp;&nbsp;&nbsp;<h4>ERROR: missing axis Y"+e+"</h4>At least one time series must be displayed on Y"+e+" axes.<br>Please change axis selection clicking on axis icons: <img src='./img/y0axis.png'> <img src='./img/y1axis.png'> <img src='./img/y2axis.png'>");lab=ylab[e][0];for(r=1;r<ylab[e].length;r++)if(lab!=ylab[e][r]){lab=ylab[e].join(" - ");break}d.yAxis[e-1].title={text:"Y"+e+" - "+lab}}}Highcharts.setOptions({global:{useUTC:!1}});myPlot=
new Highcharts.Chart(d,function(x){-1!=mychart?mychart=this:(mychart=this,$(document).keydown(function(z){var u="undefined"==typeof mychart.hoverSeries||null==mychart.hoverSeries?0:mychart.hoverSeries.index;switch(z.which){case 37:0<activePoint&&activePoint--;break;case 39:activePoint+1<mychart.series[u].data.length&&activePoint++}"undefined"!==typeof mychart.series[u]&&mychart.tooltip.refresh(mychart.series[u].data[activePoint])}))});for(p in myPlotClass)!1===myPlotClass[p].showInLegend&&($("#event_"+
myPlotClass[p].name).off("click"),$("#event_"+myPlotClass[p].name).click({name:p,label:myPlotClass[p].name},function(x){myPlotClass[x.data.name].name!==x.data.label||myPlotClass[x.data.name].done||(myPlot.series[x.data.name].setVisible(),fade_level[x.data.label]=1.5-fade_level[x.data.label],$("#event_"+x.data.label).fadeTo(400,fade_level[x.data.label]))}))}
function flotFrameTs(){if(frameNum>=globalVal.length)animationDelay=0;else if(0!=animationDelay){var a=new Date(globalVal[frameNum][0]-0);$("body").find("#animationTime").html(a.format("Y-m-d H:i:s"));myPlotClass=[[]];myPlotClass[0].label=globalLabel;myPlotClass[0].data=globalVal[frameNum][1];myPlotClass[0].lines={show:!0,fill:!1};flotOptions.yaxis={position:"left",min:minVal,max:maxVal};$.plot($("#placeholder"),myPlotClass,flotOptions);$("#animationSlider").slider("value",frameNum);frameNum++;animationDelay&&
setTimeout(function(){flotFrameTs()},animationDelay)}}
function flotAnimationTs(a,b,d){$("#animationSlider").width($("#plotContainer").width()-20);globalVal=[];b="start="+b+"&decimation="+decimation+"&decimation_samples="+decimationSamples;var f="";d.length&&(f="&stop="+d);$.get(plotService+"&"+b+f+"&ts="+a+"&no_pretimer&no_posttimer",function(g){minVal=maxVal=g.ts[0].data[0][1][0];globalLabel=g.ts[0].label;for(var e,h=0;h<g.ts[0].data.length;h++){globalVal[h]=[g.ts[0].data[h][0],[]];for(var k=0;k<g.ts[0].data[h][1].length;k++)e=g.ts[0].data[h][1][k],
globalVal[h][1][k]=[k,e],minVal>e&&(minVal=e),maxVal<e&&(maxVal=e)}g=(maxVal-minVal)/20;maxVal+=g;minVal-=g;$("#animationSlider").slider({range:!1,min:0,max:globalVal.length-1});$("#animationSlider").slider({stop:function(r,q){frameNum=q.value;flotFrameTs()}});animationDelay=100;frameNum=0;setTimeout(function(){flotFrameTs()},10)})}
function hcFrameTs(){if(frameNum>=globalVal.length)animationDelay=0;else if(0!=animationDelay){var a=new Date(globalVal[frameNum][0]-0);$("body").find("#animationTime").html(a.format("Y-m-d H:i:s"));a=document.getElementById("placeholder");var b="step";document.getElementById("style")&&document.getElementById("style").value.length&&(b=document.getElementById("style").value);a={chart:{renderTo:a,type:"step"==b?"line":b,height:800},title:{text:"eGiga2m"},plotOptions:{series:{animation:!1}},yAxis:[{title:{text:"Y"},
labels:{formatter:function(){return 1E-5===this.value?0:this.value}}}],series:[{name:globalLabel,step:"step"==b?"left":!1,data:globalVal[frameNum][1]}]};a.yAxis[0].min=minVal;a.yAxis[0].max=maxVal;Highcharts.setOptions({global:{useUTC:!1}});new Highcharts.Chart(a);$("#animationSlider").slider("value",frameNum);frameNum++;animationDelay&&setTimeout(function(){hcFrameTs()},animationDelay)}}
function hcAnimationTs(a,b,d){$("#animationSlider").width($("#plotContainer").width()-20);globalVal=[];b="start="+b+"&decimation="+decimation+"&decimation_samples="+decimationSamples;var f="";d.length&&(f="&stop="+d);$.get(plotService+"&"+b+f+"&ts="+a+"&no_pretimer&no_posttimer",function(g){minVal=maxVal=g.ts[0].data[0][1][0];globalLabel=g.ts[0].label;for(var e,h=0;h<g.ts[0].data.length;h++){globalVal[h]=[g.ts[0].data[h][0],[]];for(var k=0;k<g.ts[0].data[h][1].length;k++)e=g.ts[0].data[h][1][k],globalVal[h][1][k]=
[k,e],minVal>e&&(minVal=e),maxVal<e&&(maxVal=e)}g=(maxVal-minVal)/20;maxVal+=g;minVal-=g;$("#animationSlider").slider({range:!1,min:0,max:globalVal.length-1});animationDelay=100;frameNum=0;$("#animationSlider").slider({stop:function(r,q){frameNum=q.value;hcFrameTs()}});setTimeout(function(){hcFrameTs()},10)})}function stopAnimation(){frameNum=animationDelay=0;$("#animationSlider").slider("value",frameNum)}function pauseAnimation(){animationDelay=0}
function playAnimation(){0==animationDelay&&(document.getElementById("show_flot").checked&&setTimeout(function(){flotFrameTs()},10),document.getElementById("show_hc").checked&&setTimeout(function(){hcFrameTs()},10));animationDelay=100}function ffAnimation(){0==animationDelay?(animationDelay=50,document.getElementById("show_flot").checked&&setTimeout(function(){flotFrameTs()},10),document.getElementById("show_hc").checked&&setTimeout(function(){hcFrameTs()},10)):animationDelay/=2}
var surfacePlot,data,options,basicPlotOptions,glOptions,animated,plot1,values=[],times=[];function plotSurfaceTs(a,b,d){console.log("plotSurfaceTs()",a,b,d);var f=document.createElement("iframe");f.style.width="100%";f.style.border="0";f.style.height=document.getElementById("placeholder").style.height;f.src="./lib/threejs/mesh.html?conf="+$_GET.conf+"&start="+b+"&stop="+d+"&ts="+a;document.getElementById("placeholder").appendChild(f);console.log("plotSurfaceTs() done")}
function plotSurfaceTsOld(a,b,d){var f="";d.length&&(f="&stop="+d);$.get(plotService+"&start="+b+f+"&ts="+a+"&no_pretimer&no_posttimer",function(g){for(var e=g.ts[0].data.length,h=Math.round(e/5),k=0;k<e;k++)0==k%h&&(times[k/h]=(new Date(g.ts[0].data[k][0]-0)).format("Y-m-d H:i:s")),values[k]=g.ts[0].data[k][1];g=values[0].length;data={nRows:e,nCols:g,formattedValues:values};$("#placeholder").empty();surfacePlot=new SurfacePlot(document.getElementById("placeholder"));basicPlotOptions={fillPolygons:!0,
tooltips:[],renderPoints:!0};e=[];h=1;20<g&&(h=Math.round(g/10));for(k=0;k<=g;k+=h)e[k/h]=k;glOptions={xLabels:times,yLabels:e,chkControlId:"allowWebGL",autoCalcZScale:!0,animate:!1};options={xPos:0,yPos:0,width:1200,height:800,colourGradient:[{red:0,green:0,blue:255},{red:0,green:255,blue:255},{red:0,green:255,blue:0},{red:255,green:255,blue:0},{red:255,green:0,blue:0}],xTitle:"",yTitle:"samples",zTitle:"values",backColour:"#f8f8f8",axisTextColour:"#000000",hideFlatMinPolygons:!1,origin:{x:600,y:400}};
surfacePlot.draw(data,options,basicPlotOptions,glOptions)})};
